version: "3.8"

volumes:
  yakimoto_database:
    driver: local
  yakimoto_uploads:
    driver: local

services:
  backend:
    build:
      context: ./backend
    container_name: yakimoto_backend
    ports:
      - "8000:8000"
    volumes:
      # Use named volumes for persistent data (survives rebuilds and git resets)
      # Database stored in Docker volume - persists across rebuilds
      - yakimoto_database:/app/app/data
      # Uploads stored in Docker volume - persists across rebuilds
      - yakimoto_uploads:/app/app/uploads
    environment:
      # Point database to volume location
      - DATA_DIR=/app/app/data
    restart: always
    env_file:
      - .env

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.prod
      args:
        VITE_API_URL: https://yakimoto.se/api
        VITE_GA_MEASUREMENT_ID: G-ZVJQZJY399
        VITE_GOOGLE_ADS_ID: AW-17570454559
    container_name: yakimoto_frontend
    ports:
      - "8080:80"
    depends_on:
      - backend
    restart: always
    env_file:
      - .env
