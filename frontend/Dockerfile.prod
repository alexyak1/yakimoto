# Build stage
FROM node:20 AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
ARG VITE_API_URL
ENV VITE_API_URL=$VITE_API_URL
RUN npm run build

# Serve static files directly (no internal nginx)
FROM python:3.11-slim
RUN pip install --no-cache-dir waitress
WORKDIR /app
COPY --from=builder /app/dist /app
COPY serve.py .

CMD ["waitress-serve", "--listen=0.0.0.0:80", "serve:app"]
